<div>
  <app-description Menu='NSX-T Fabric - Host/Edge Nodes'></app-description>
</div>
<p class="p6">
  <!-- Button groups-->  
<div class="btn-group">
  <div class="btn-group">
    <clr-dropdown>
      <button class="btn" clrDropdownTrigger *ngIf="loading else export" disabled>
        <cds-icon shape="download-cloud" ></cds-icon>
        Export
      </button>
    <ng-template #export>
      <button class="btn" clrDropdownTrigger>
        <cds-icon shape="download-cloud"></cds-icon>
        Export
      </button>
    </ng-template>
    <clr-dropdown-menu *clrIfOpen clrPosition="bottom-left">
      <a (click)="Export('XLS', this.TabNodes, Name)" clrDropdownItem>Export in Excel</a>
      <a (click)="Export('CSV', this.TabNodes, Name)" clrDropdownItem>Export in CSV</a>
      <a (click)="Export('JSON', this.TabNodes, Name)" clrDropdownItem>Export in JSON</a>
      <a (click)="Export('YAML', this.TabNodes, Name)" clrDropdownItem>Export in YAML</a>
    </clr-dropdown-menu>
    </clr-dropdown>
  </div>
  <div class="btn-group">
      <!-- Diff part-->
      <app-diff #appDiff Name={{Name}} [Tab]=this.TabNodes (diffArrayOut)="getDiff($event)"></app-diff>
      <button class="btn" *ngIf="loading else diff" disabled>
        <cds-icon shape="file-group"></cds-icon>
        Diff
      </button>
      <ng-template #diff>
        <button class="btn" (click)="appDiff.StartWizard()">
          <cds-icon shape="file-group"></cds-icon>
          Diff
        </button>
      </ng-template>
      <clr-dropdown>
        <button class="btn" clrDropdownTrigger *ngIf="!isCompared else exportdiff" disabled>
          <cds-icon shape="download-cloud" ></cds-icon>
          Export Diff
        </button>
        <ng-template #exportdiff>
          <button class="btn" clrDropdownTrigger>
            <cds-icon shape="download-cloud"></cds-icon>
            Export Diff
          </button>
        </ng-template>
        <clr-dropdown-menu *clrIfOpen clrPosition="bottom-left">
          <a (click)="Export('XLS', this.DiffTab, 'Diff_' + Name)" clrDropdownItem>Export in Excel</a>
          <a (click)="Export('CSV', this.DiffTab, 'Diff_' + Name)" clrDropdownItem>Export in CSV</a>
          <a (click)="Export('JSON', this.DiffTab, 'Diff_' + Name)" clrDropdownItem>Export in JSON</a>
          <a (click)="Export('YAML', this.DiffTab, 'Diff_' + Name)" clrDropdownItem>Export in YAML</a>
        </clr-dropdown-menu>
      </clr-dropdown>
</div>
</div>
<!-- Alert in case of error-->
<div class="alert alert-danger" role="alert" *ngIf="error">
  <div class="alert-items">
    <div class="alert-item static">
      <div class="alert-icon-wrapper">
        <cds-icon class="alert-icon" shape="exclamation-circle"></cds-icon>
      </div>
      <span class="alert-text">
        {{error_message}}
      </span>
    </div>
</div>
<button type="button" class="close" aria-label="Close" (click)="error = false">
  <cds-icon aria-hidden="true" shape="window-close" ></cds-icon>
</button>
</div>
<p class="p3">
  <clr-tabs>
    <!-- Dashboard -->
    <clr-tab>
      <button clrTabLink>Transport Nodes</button>
      <clr-tab-content *clrIfActive>
        <clr-datagrid [clrDgLoading]="loading">
          <clr-dg-column [clrDgField]="'name'">Transport Node Name</clr-dg-column>
          <clr-dg-column [clrDgField]="'managementIp'">Mgmt IP</clr-dg-column>
          <clr-dg-column [clrDgField]="'host_switch_name'">Switch Name</clr-dg-column>
          <clr-dg-column [clrDgField]="'host_switch_type'">Switch Mode</clr-dg-column>
          <clr-dg-column [clrDgField]="'TZ'">Transport Zones</clr-dg-column>
          <clr-dg-column [clrDgField]="'powerState'">Power State</clr-dg-column>
          <clr-dg-column [clrDgField]="'host_node_deployment_status'">Deployement Status</clr-dg-column>
          <clr-dg-placeholder>We couldn't find any Transport Nodes !</clr-dg-placeholder>
                
          <clr-dg-row *clrDgItems="let tn of this.TabHost" [clrDgItem]="tn">
          <clr-dg-cell>{{tn.name}}</clr-dg-cell>
          <clr-dg-cell>{{tn.managementIp}}</clr-dg-cell>
          <clr-dg-cell>
            <div *ngFor="let sw of tn.hostswitch">
            {{sw.name}}
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div *ngFor="let sw of tn.hostswitch">
              {{sw.type}}
              </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <div *ngFor="let tz of tn.TZ">
              {{tz.name}}
            </div>
          </clr-dg-cell>
          <clr-dg-cell>
            <span class="label label-success" *ngIf="tn.powerState === 'poweredOn'">{{tn.powerState}}</span>
            <span class="label label-danger" *ngIf="tn.powerState !== 'poweredOn'">{{tn.powerState}}</span>
          </clr-dg-cell>
          <clr-dg-cell>
              <span class="label label-success" *ngIf="tn.host_node_deployment_status === 'INSTALL_SUCCESSFUL'">{{tn.host_node_deployment_status}}</span>
              <span class="label label-danger" *ngIf="tn.host_node_deployment_status !== 'INSTALL_SUCCESSFUL'">{{tn.host_node_deployment_status}}</span>
          </clr-dg-cell>
          </clr-dg-row>
          <clr-dg-footer>
              <clr-dg-pagination #pagination [clrDgPageSize]="10">
              <clr-dg-page-size [clrPageSizeOptions]="[10,20,50,100]">Transport Nodes per page</clr-dg-page-size>
              {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}} of {{pagination.totalItems}} Transport Nodes
              </clr-dg-pagination>
          </clr-dg-footer>
          <clr-dg-detail *clrIfDetail="let detail">
                        <clr-dg-detail-header>Details of {{detail.name}} </clr-dg-detail-header>
                        <clr-dg-detail-body>
                          <table class="table table-vertical table-noborder">
                            <tbody>
                              <tr>
                                <th>Transport Node Name</th>
                                <td>{{detail.name.toUpperCase()}}</td>
                              </tr>
                              <tr>
                                <th>Management IP</th>
                                <td>{{detail.managementIp}}</td>
                              </tr>
                              <tr>
                                <th>ID</th>
                                <td>{{detail.id}}</td>
                              </tr>
                              <tr>
                              <tr>
                                <th>Power State</th>
                                <td>
                                  <span class="label label-success" *ngIf="detail.powerState === 'poweredOn'">{{detail.powerState}}</span>
                                  <span class="label label-danger" *ngIf="detail.powerState !== 'poweredOn'">{{detail.powerState}}</span>              
                                </td>
                              </tr>
                              <tr>
                              <tr>
                                <th>Deployement Status</th>
                                <td>
                                  <span class="label label-success" *ngIf="detail.host_node_deployment_status === 'INSTALL_SUCCESSFUL'">{{detail.host_node_deployment_status}}</span>
                                  <span class="label label-danger" *ngIf="detail.host_node_deployment_status !== 'INSTALL_SUCCESSFUL'">{{detail.host_node_deployment_status}}</span>          
                                </td>
                              </tr>
                              <tr>
                                <th>Version</th>
                                <td>{{detail.full_version}}</td>
                              </tr>
                              <tr>
                                <th>Serial Number</th>
                                <td>{{detail.serialNumber}}</td>
                              </tr>
                              <tr>
                                <th>Switch Name</th>
                                <td>
                                  <div *ngFor="let sw of detail.hostswitch">
                                    {{sw.name}}
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <th>Switch Mode</th>
                                <td>
                                  <div *ngFor="let sw of detail.hostswitch">
                                    {{sw.mode}}
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <th>Switch Type</th>
                                <td>
                                  <div *ngFor="let sw of detail.hostswitch">
                                    {{sw.type}}
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <th>Transport Zones</th>
                                <td>
                                  <div *ngFor="let tz of detail.TZ">
                                    {{tz.name}}
                                  </div>
                                </td>
                              </tr>
                            <tr>
                              <th>Uplink Profile</th>
                              <td>
                              <div *ngFor="let sw of detail.hostswitch">
                                <div *ngIf="sw.profile">
                                {{sw.profile.name}}
                                </div>
                              </div>
                            </td>
                           </tr>
                            <tr>
                              <th>Teaming Policy</th>
                              <td>
                                <div *ngFor="let sw of detail.hostswitch">
                                  <div *ngIf="sw.profile">
                                    {{sw.profile.teaming.policy}}
                                    </div>
                                </div>
                              </td>
                           </tr>
                            <tr>
                              <th>Active Interface</th>
                              <td>
                                <div *ngFor="let sw of detail.hostswitch">
                                  <div *ngIf="sw.profile">
                                  <div *ngFor="let int of sw.profile.teaming.active_list">
                                  {{int.uplink_name}} ({{int.device_name}})
                                  </div>
                                </div>
                              </div>
                              </td>
                           </tr>
                            <tr>
                              <th>Transport VLAN</th>
                              <td>
                                <div *ngFor="let sw of detail.hostswitch">
                                  <div *ngIf="sw.profile">
                                  {{sw.profile.transport_vlan}}
                                  </div>
                                </div>
                              </td>
                           </tr>
                            <tr>
                              <th>MTU</th>
                              <td>
                                <div *ngFor="let sw of detail.hostswitch">
                                  <div *ngIf="sw.profile">
                                  <span class="label label-success" *ngIf="sw.profile.mtu >= 1600">{{sw.profile.mtu}}</span>
                                  <span class="label label-danger" *ngIf="sw.profile.mtu < 1600">{{sw.profile.mtu}}</span>          
                                  </div>
                                  </div>
                              </td>
                              </tr>
                            </tbody>
                          </table>
                        </clr-dg-detail-body>
          </clr-dg-detail>
        </clr-datagrid>
      </clr-tab-content>
    </clr-tab>
    <clr-tab>
      <button clrTabLink>Edge Nodes</button>
      <clr-tab-content *clrIfActive>
                <clr-datagrid [clrDgLoading]="loading">
                    <clr-dg-column [clrDgField]="'name'">Edge Node Name</clr-dg-column>
                    <clr-dg-column [clrDgField]="'managementIp'">Mgmt IP</clr-dg-column>
                    <clr-dg-column [clrDgField]="'host_switch_name'">Switch Name</clr-dg-column>
                    <clr-dg-column [clrDgField]="'host_switch_type'">Switch Type</clr-dg-column>
                    <clr-dg-column [clrDgField]="'TZ'">Transport Zones</clr-dg-column>
                    <clr-dg-placeholder>We couldn't find any Edges Nodes !</clr-dg-placeholder>
                
                    <clr-dg-row *clrDgItems="let tn of this.TabEdge" [clrDgItem]="tn">
                    <clr-dg-cell>{{tn.name}}</clr-dg-cell>
                    <clr-dg-cell>{{tn.managementIp}}</clr-dg-cell>
                    <clr-dg-cell>
                      <div *ngFor="let sw of tn.hostswitch">
                      {{sw.name}}
                      </div>
                    </clr-dg-cell>
                    <clr-dg-cell>
                      <div *ngFor="let sw of tn.hostswitch">
                        {{sw.type}}
                        </div>
                    </clr-dg-cell>
                    <clr-dg-cell>
                      <div *ngFor="let tz of tn.TZ">
                        {{tz.name}}
                      </div>
                    </clr-dg-cell>
                    </clr-dg-row>
                    <clr-dg-footer>
                        <clr-dg-pagination #pagination [clrDgPageSize]="10">
                        <clr-dg-page-size [clrPageSizeOptions]="[10,20,50,100]">Edge Nodes per page</clr-dg-page-size>
                        {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}} of {{pagination.totalItems}} Edge Nodes
                        </clr-dg-pagination>
                    </clr-dg-footer>
                    <clr-dg-detail *clrIfDetail="let detail">
                        <clr-dg-detail-header>Details of {{detail.name}} </clr-dg-detail-header>
                        <clr-dg-detail-body>
                          <table class="table table-vertical table-noborder">
                            <tbody>
                              <tr>
                                <th>Edge Node Name</th>
                                <td>{{detail.name.toUpperCase()}}</td>
                              </tr>
                              <tr>
                                <th>ID</th>
                                <td>{{detail.id}}</td>
                              </tr>
                              <tr>
                                <th>Management IP</th>
                                <td>{{detail.managementIp}}</td>
                              </tr>
                              <tr>
                                <th>Switch Name</th>
                                <td>
                                  <div *ngFor="let sw of detail.hostswitch">
                                    {{sw.name}}
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <th>Switch Mode</th>
                                <td>
                                  <div *ngFor="let sw of detail.hostswitch">
                                    {{sw.mode}}
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <th>Switch Type</th>
                                <td>
                                  <div *ngFor="let sw of detail.hostswitch">
                                    {{sw.type}}
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <th>Transport Zones</th>
                                <td>
                                  <div *ngFor="let tz of detail.TZ">
                                    {{tz.name}}
                                  </div>
                                </td>
                              </tr>
                              <tr>
                                <th>Uplink Profile</th>
                                <td>
                                <div *ngFor="let sw of detail.hostswitch">
                                  {{sw.profile.name}}
                                </div>
                              </td>
                             </tr>
                              <tr>
                                <th>Teaming Policy</th>
                                <td>
                                  <div *ngFor="let sw of detail.hostswitch">
                                    {{sw.profile.teaming.policy}}
                                  </div>
                                </td>
                             </tr>
                              <tr>
                                <th>Active Interface</th>
                                <td>
                                  <div *ngFor="let sw of detail.hostswitch">
                                    <div *ngFor="let int of sw.profile.teaming.active_list">
                                    {{int.uplink_name}} ({{int.device_name}})
                                    </div>
                                </div>
                                </td>
                             </tr>
                              <tr>
                                <th>Transport VLAN</th>
                                <td>
                                  <div *ngFor="let sw of detail.hostswitch">
                                    {{sw.profile.transport_vlan}}
                                  </div>
                                </td>
                             </tr>
                              <tr>
                                <th>MTU</th>
                                <td>
                                  <div *ngFor="let sw of detail.hostswitch">
                                    <span class="label label-success" *ngIf="sw.profile.mtu >= 1600">{{sw.profile.mtu}}</span>
                                    <span class="label label-danger" *ngIf="sw.profile.mtu < 1600">{{sw.profile.mtu}}</span>          
                                    </div>
                                </td>
                             </tr>
                            </tbody>
                          </table>
                        </clr-dg-detail-body>
                    </clr-dg-detail>
                </clr-datagrid>
      </clr-tab-content>
    </clr-tab>
    <!-- Diff Tab -->
    <clr-tab *ngIf="isCompared">
      <button clrTabLink>Diff</button>
      <clr-tab-content *clrIfActive="true">
        <clr-datagrid>
          <clr-dg-column [clrDgField]="'diffstatus'">Diff Status</clr-dg-column>
          <clr-dg-column *ngFor="let col of HeaderDiff" [clrDgField]=col.col>{{col.header}}</clr-dg-column>
          <clr-dg-placeholder>We couldn't find any {{Name}} !</clr-dg-placeholder>
          <clr-dg-row *clrDgItems="let item of this.DiffTab" [clrDgItem]="item" 
          [ngClass]="{
            'created': (item.diffstatus === 'Created'  ),
            'deleted': (item.diffstatus === 'Deleted'  ),
            'modified': (item.diffstatus === 'Modified'  ),
            'unchanged': (item.diffstatus === 'Unchanged'  )
              }">
              <clr-dg-cell>
                      <span class="label label-success" *ngIf="item.diffstatus === 'Unchanged'">{{ item.diffstatus }}</span>
                      <span class="label label-warning" *ngIf="item.diffstatus === 'Modified'">{{ item.diffstatus }}</span>
                      <span class="label label-danger" *ngIf="item.diffstatus === 'Deleted'">{{ item.diffstatus }}</span>
                      <span class="label label-info" *ngIf="item.diffstatus === 'Created'">{{ item.diffstatus }}</span>
              </clr-dg-cell>
              <clr-dg-cell *ngFor="let col of HeaderDiff">
                  <div *ngIf="typeOf(item[col.col]) === 'object'">
                          <div *ngIf="item[col.col][col.subcol] && item[col.col][col.subcol].toString().includes('||') else diff">
                              <span class="label label-danger" *ngIf="item[col.col][col.subcol].toString().split('||')[0] != '+'"> <s>{{item[col.col][col.subcol].toString().split('||')[0]}}</s></span>
                              <span class="label label-info" *ngIf="item[col.col][col.subcol].toString().split('||')[1] != '-'">{{item[col.col][col.subcol].toString().split('||')[1]}}</span>
                            </div>
                            <ng-template #diff>
                              {{item[col.col][col.subcol]}}
                            </ng-template>
                  </div>
                  <div *ngIf="isArray(item[col.col])">
                          <div *ngFor="let subitem of item[col.col]">
                              <div *ngIf="typeOf(subitem) === 'object'">
                                  <div *ngIf="subitem[col.subcol] && subitem[col.subcol].toString().includes('||') else diff">
                                      <span class="label label-danger" *ngIf="subitem[col.subcol].split('||')[0] != '+'"> <s>{{subitem[col.subcol].split('||')[0]}}</s></span>
                                      <span class="label label-info" *ngIf="subitem[col.subcol].split('||')[1] != '-'">{{subitem[col.subcol].split('||')[1]}}</span>
                                    </div>
                                    <ng-template #diff>
                                      {{subitem[col.subcol]}}
                                    </ng-template>
                              </div>
                              <div *ngIf="typeOf(subitem) === 'string' || typeOf(subitem) === 'number'">
                                  <div *ngIf="subitem && subitem.toString().includes('||') else diff">
                                      <span class="label label-danger" *ngIf="subitem.split('||')[0] != '+'"> <s>{{subitem.split('||')[0]}}</s></span>
                                      <span class="label label-info" *ngIf="subitem.split('||')[1] != '-'">{{subitem.split('||')[1]}}</span>
                                    </div>
                                    <ng-template #diff>
                                      {{subitem}}
                                    </ng-template>
                              </div>
                          </div>
                  </div>
                  <div *ngIf="typeOf(item[col.col]) !== 'object'">
                        <div *ngIf="item[col.col] && item[col.col].toString().includes('||') else diff">
                            <span class="label label-danger" *ngIf="item[col.col].toString().split('||')[0] != '+'"> <s>{{item[col.col].toString().split('||')[0]}}</s></span>
                            <span class="label label-info" *ngIf="item[col.col].toString().split('||')[1] != '-'">{{item[col.col].toString().split('||')[1]}}</span>
                          </div>
                          <ng-template #diff>
                            {{item[col.col]}}
                          </ng-template>
                  </div>
              </clr-dg-cell>
          </clr-dg-row>
          <clr-dg-footer>
                   <clr-dg-pagination #pagination [clrDgPageSize]="20">
                     <clr-dg-page-size [clrPageSizeOptions]="[10,20,50,100]">{{Name}} per page</clr-dg-page-size>
                     {{pagination.firstItem + 1}} - {{pagination.lastItem + 1}} of {{pagination.totalItems}} {{Name}}
                   </clr-dg-pagination>
          </clr-dg-footer>
        </clr-datagrid>
      </clr-tab-content>
    </clr-tab>
  </clr-tabs>
</p>